// ==UserScript==
// @name        ac-predictor-cn
// @namespace   https://github.com/GoodCoder666/ac-predictor-extension-CN
// @icon        https://atcoder.jp/favicon.ico
// @version     1.2.16
// @description AtCoder 预测工具 (由GoodCoder666翻译为简体中文)
// @author      GoodCoder666
// @license     MIT
// @supportURL  https://github.com/GoodCoder666/ac-predictor-extension-CN/issues
// @match       https://atcoder.jp/*
// @exclude     https://atcoder.jp/*/json
// ==/UserScript==
function __awaiter(t,e,n,s){return new(n||(n=Promise))(function(i,r){function a(t){try{d(s.next(t))}catch(t){r(t)}}function o(t){try{d(s.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,o)}d((s=s.apply(t,e||[])).next())})}var dom='<div id="predictor-alert" class="row"><h5 class="sidemenu-txt">加载中…</h5></div>\n<div id="predictor-data" class="row">\n    <div class="input-group col-xs-12">\n        <span class="input-group-addon">名次\n            <style>\n                .predictor-tooltip-icon:hover+.tooltip{\n                    opacity: .9;\n                    filter: alpha(opacity=90);\n                }\n            </style>\n            <span class="predictor-tooltip-icon glyphicon glyphicon-question-sign"></span>\n            <div class="tooltip fade bottom" style="pointer-events:none">\n                <div class="tooltip-arrow" style="left: 18%;"></div>\n                <div class="tooltip-inner">Rated 范围内的排名，多人同名次时加上人数。</div>\n            </div>\n        </span>\n        <input class="form-control" id="predictor-input-rank">\n        <span class="input-group-addon">位</span>\n    </div>\n        \n    <div class="input-group col-xs-12">\n        <span class="input-group-addon">Performance</span>\n        <input class="form-control" id="predictor-input-perf">\n    </div>\n\n    <div class="input-group col-xs-12">\n        <span class="input-group-addon">预计 Rating</span>\n        <input class="form-control" id="predictor-input-rate">\n    </div>\n</div>\n<div class="row">\n    <div class="btn-group">\n        <button class="btn btn-default" id="predictor-current">现在的名次</button>\n        <button type="button" class="btn btn-primary" id="predictor-reload" data-loading-text="更新中…">更新</button>\n        \x3c!--<button class="btn btn-default" id="predictor-solved" disabled>当前问题AC后</button>--\x3e\n    </div>\n</div>';class Result{constructor(t,e,n,s,i,r,a,o,d,l){this.IsRated=t,this.IsSubmitted=e,this.UserScreenName=n,this.Place=s,this.RatedRank=i,this.OldRating=r,this.NewRating=a,this.Competitions=o,this.Performance=d,this.InnerPerformance=l}}function analyzeStandingsData(t,e,n,s,i,r){function a(i){const a=[],o={};let d=1,l=0;const c=[];let u=0;function p(){c.forEach(t=>{i(t)&&(a.push(n[t.UserScreenName]||s),u++)});const e=d+Math.max(0,u-1)/2;c.forEach(n=>{o[n.UserScreenName]=new Result(!r&&i(n),!r||0!==n.TotalResult.Count,n.UserScreenName,n.Rank,e,t?n.OldRating:n.Rating,null,n.Competitions,null,null)}),d+=u,c.length=0,u=0}return e.forEach(t=>{l!==t.Rank&&p(),l=t.Rank,c.push(t)}),p(),{contestantAPerf:a,templateResults:o}}let o=a(t=>t.IsRated&&(!r||0!==t.TotalResult.Count)),d=!0;0===o.contestantAPerf.length&&(o=a(t=>t.OldRating<i&&(!r||0!==t.TotalResult.Count)),d=!1);const l=o;return l.isRated=d,l}class Contest{constructor(t,e,n,s){this.ratedLimit=e.RatedRange[1]+1,this.perfLimit=this.ratedLimit+400,this.standings=n,this.aPerfs=s,this.rankMemo={};const i=analyzeStandingsData(n.Fixed,n.StandingsData,s,e.isHeuristic?1e3:{2000:800,2800:1e3,Infinity:1200}[this.ratedLimit]||1200,this.ratedLimit,e.isHeuristic);this.contestantAPerf=i.contestantAPerf,this.templateResults=i.templateResults,this.IsRated=i.isRated}getRatedRank(t){return this.rankMemo[t]?this.rankMemo[t]:this.rankMemo[t]=this.contestantAPerf.reduce((e,n)=>e+1/(1+Math.pow(6,(t-n)/400)),.5)}getPerf(t){return Math.min(this.getInnerPerf(t),this.perfLimit)}getInnerPerf(t){let e=6144,n=-2048;for(;e-n>.5;){const s=(e+n)/2;t>this.getRatedRank(s)?e=s:n=s}return Math.round((e+n)/2)}}class Results{}const finf=bigf(400);function bigf(t){let e=1,n=1,s=0,i=0;for(let r=0;r<t;++r)s+=e*=.81,i+=n*=.9;return Math.sqrt(s)/i}function f(t){return(bigf(t)-finf)/(bigf(1)-finf)*1200}function calcRatingFromHistory(t){const e=t.length;let n=1,s=0,i=0;for(let r=e-1;r>=0;r--)n*=.9,s+=Math.pow(2,t[r]/800)*n,i+=n;return 800*Math.log2(s/i)-f(e)}function calcRatingFromLast(t,e,n){if(0===n)return e-1200;t+=f(n);const s=9-9*Math.pow(.9,n),i=s*Math.pow(2,t/800)+Math.pow(2,e/800),r=1+s;return 800*Math.log2(i/r)-f(n+1)}function positivizeRating(t){return t>=400?t:400*Math.exp((t-400)/400)}function unpositivizeRating(t){return t>=400?t:400+400*Math.log(t/400)}function calcRequiredPerformance(t,e){let n=1e4,s=-1e4;for(let i=0;i<100;++i){const i=(s+n)/2;t<=Math.round(calcRatingFromHistory(e.concat([i])))?n=i:s=i}return n}const colorNames=["unrated","gray","brown","green","cyan","blue","yellow","orange","red"];function getColor(t){const e=t>0?Math.min(Math.floor(t/400)+1,8):0;return colorNames[e]}class OnDemandResults extends Results{constructor(t,e){super(),this.Contest=t,this.TemplateResults=e}getUserResult(t){if(!Object.prototype.hasOwnProperty.call(this.TemplateResults,t))return null;const e=this.TemplateResults[t];return e?(e.Performance||(e.InnerPerformance=this.Contest.getInnerPerf(e.RatedRank),e.Performance=Math.min(e.InnerPerformance,this.Contest.perfLimit),e.NewRating=Math.round(positivizeRating(calcRatingFromLast(unpositivizeRating(e.OldRating),e.Performance,e.Competitions)))),e):null}}class FixedResults extends Results{constructor(t){super(),this.resultsDic={},t.forEach(t=>{this.resultsDic[t.UserScreenName]=t})}getUserResult(t){return Object.prototype.hasOwnProperty.call(this.resultsDic,t)?this.resultsDic[t]:null}}class PredictorModel{constructor(t){this.enabled=t.enabled,this.contest=t.contest,this.history=t.history,this.updateInformation(t.information),this.updateData(t.rankValue,t.perfValue,t.rateValue)}setEnable(t){this.enabled=t}updateInformation(t){this.information=t}updateData(t,e,n){this.rankValue=t,this.perfValue=e,this.rateValue=n}}class CalcFromRankModel extends PredictorModel{updateData(t,e,n){e=this.contest.getPerf(t),n=positivizeRating(calcRatingFromHistory(this.history.concat([e]))),super.updateData(t,e,n)}}class CalcFromPerfModel extends PredictorModel{updateData(t,e,n){t=this.contest.getRatedRank(e),n=positivizeRating(calcRatingFromHistory(this.history.concat([e]))),super.updateData(t,e,n)}}class CalcFromRateModel extends PredictorModel{updateData(t,e,n){e=calcRequiredPerformance(unpositivizeRating(n),this.history),t=this.contest.getRatedRank(e),super.updateData(t,e,n)}}function roundValue(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}class ContestInformation{constructor(t,e,n,s){this.CanParticipateRange=t,this.RatedRange=e,this.Penalty=n,this.isHeuristic=s}}function parseRangeString(t){if("-"===(t=t.trim()))return[0,-1];if("All"===t)return[0,1/0];if(!/[-~]/.test(t))return[0,-1];const e=t.split(/[-~]/).map(t=>parseInt(t.trim()));return isNaN(e[0])&&(e[0]=0),isNaN(e[1])&&(e[1]=1/0),e}function parseDurationString(t){if("None"===t||"なし"===t)return 0;if(!/(\d+[^\d]+)/.test(t))return NaN;const e={"日":864e5,day:864e5,days:864e5,"時間":36e5,hour:36e5,hours:36e5,"分":6e4,minute:6e4,minutes:6e4,"秒":1e3,second:1e3,seconds:1e3};let n=0;return t.match(/(\d+[^\d]+)/g).forEach(t=>{var s;const i=t.trim(),r=parseInt(/\d+/.exec(i)[0]),a=/[^\d]+/.exec(i)[0],o=null!==(s=e[a])&&void 0!==s?s:0;n+=r*o}),n}function fetchJsonDataAsync(t){return __awaiter(this,void 0,void 0,function*(){const e=yield fetch(t);if(e.ok)return yield e.json();throw new Error(`request to ${t} returns ${e.status}`)})}function fetchTextDataAsync(t){return __awaiter(this,void 0,void 0,function*(){const e=yield fetch(t);if(e.ok)return e.text();throw new Error(`request to ${t} returns ${e.status}`)})}function getStandingsDataAsync(t){return __awaiter(this,void 0,void 0,function*(){return yield fetchJsonDataAsync(`https://atcoder.jp/contests/${t}/standings/json`)})}function getAPerfsDataAsync(t){return __awaiter(this,void 0,void 0,function*(){return yield fetchJsonDataAsync(`https://data.ac-predictor.com/aperfs/${t}.json`)})}function getResultsDataAsync(t){return __awaiter(this,void 0,void 0,function*(){return yield fetchJsonDataAsync(`https://atcoder.jp/contests/${t}/results/json`)})}function getHistoryDataAsync(t){return __awaiter(this,void 0,void 0,function*(){return yield fetchJsonDataAsync(`https://atcoder.jp/users/${t}/history/json`)})}function getContestInformationAsync(t){return __awaiter(this,void 0,void 0,function*(){const e=yield fetchTextDataAsync(`https://atcoder.jp/contests/${t}`),n=(new DOMParser).parseFromString(e,"text/html").getElementsByClassName("small")[0],s=Array.from(n.children).map(t=>t.innerHTML.split(":")[1].trim()),i=/^ahc\d{3}$/.test(t)||e.includes("This contest is rated for AHC rating");return new ContestInformation(parseRangeString(s[0]),parseRangeString(s[1]),parseDurationString(s[2]),i)})}function getPerformanceHistories(t){const e=t.filter(t=>t.IsRated);return e.sort((t,e)=>new Date(t.EndTime).getTime()-new Date(e.EndTime).getTime()),e.map(t=>t.Performance)}class SideMenuElement{shouldDisplayed(t){return this.match.test(t)}GetHTML(){return`<div class="menu-wrapper">\n    <div class="menu-header">\n        <h4 class="sidemenu-txt">${this.title}<span class="glyphicon glyphicon-menu-up" style="float: right"></span></h4>\n    </div>\n    <div class="menu-box"><div class="menu-content" id="${this.id}">${this.document}</div></div>\n</div>`}}function getGlobalVals(){const t=[...document.querySelectorAll("head script:not([src])")].map(t=>t.innerHTML).join("\n"),e={};return t.match(/var [^ ]+ = .+$/gm).forEach(t=>{const n=/var ([^ ]+) = (.+)$/m.exec(t);e[n[1]]=function(t){function e(t){for(;t.endsWith(";")||t.endsWith(" ");)t=t.substr(0,t.length-1);for(;t.startsWith(" ");)t=t.substr(1,t.length-1);return t}function n(t){return 1<t.length&&t.startsWith('"')&&t.endsWith('"')}function s(t){if(!n(t))throw new Error;return t.substr(1,t.length-2)}return n(t=e(t))?s(t):t.startsWith("moment(")?new Date(s(e(t.substr(7,t.length-8)))):t}(n[2])}),e}const globalVals=getGlobalVals(),userScreenName=globalVals.userScreenName,contestScreenName=globalVals.contestScreenName,startTime=globalVals.startTime;class AllRowUpdater{update(t){Array.from(t.rows).forEach(t=>this.rowModifier.modifyRow(t))}}class StandingsRowModifier{isHeader(t){return"thead"==t.parentElement.tagName.toLowerCase()}isFooter(t){return t.firstElementChild.hasAttribute("colspan")&&"3"==t.firstElementChild.getAttribute("colspan")}modifyRow(t){this.isHeader(t)?this.modifyHeader(t):this.isFooter(t)?this.modifyFooter(t):this.modifyContent(t)}}class PerfAndRateChangeAppender extends StandingsRowModifier{modifyContent(t){var e;if(this.removeOldElem(t),"-"===t.firstElementChild.textContent){const e=t.getElementsByClassName("standings-result")[0];return void e.setAttribute("colspan",(parseInt(e.getAttribute("colspan"))+2).toString())}const n=t.querySelector(".standings-username .username span").textContent,s=null===(e=this.results)||void 0===e?void 0:e.getUserResult(n),i=(null==s?void 0:s.IsSubmitted)?this.getRatingSpan(Math.round(positivizeRating(s.Performance))):"-",r=s?(null==s?void 0:s.IsRated)&&(null==this?void 0:this.isRated)?this.getChangedRatingElem(s.OldRating,s.NewRating):this.getUnratedElem(s.OldRating):"-";t.insertAdjacentHTML("beforeend",`<td class="standings-result standings-perf">${i}</td>`),t.insertAdjacentHTML("beforeend",`<td class="standings-result standings-rate">${r}</td>`)}getChangedRatingElem(t,e){return`<span class="bold">${this.getRatingSpan(t)}</span> → <span class="bold">${this.getRatingSpan(e)}</span> <span class="grey">(${this.toSignedString(e-t)})</span>`}toSignedString(t){return`${t>=0?"+":""}${t}`}getUnratedElem(t){return`<span class="bold">${this.getRatingSpan(t)}</span> <span class="grey">(unrated)</span>`}getRatingSpan(t){return`<span class="user-${getColor(t)}">${t}</span>`}modifyFooter(t){this.removeOldElem(t),t.insertAdjacentHTML("beforeend",'<td class="standings-result standings-perf standings-rate" colspan="2">-</td>')}modifyHeader(t){this.removeOldElem(t),t.insertAdjacentHTML("beforeend",'<th class="standings-result-th standings-perf" style="width:84px;min-width:84px;">Performance</th><th class="standings-result-th standings-rate" style="width:168px;min-width:168px;">Rating 变化</th>')}removeOldElem(t){t.querySelectorAll(".standings-perf, .standings-rate").forEach(t=>t.remove())}}class PredictorElement extends SideMenuElement{constructor(){super(...arguments),this.id="predictor",this.title="Predictor",this.match=/atcoder.jp\/contests\/.+/,this.document=dom,this.historyData=[],this.contestOnUpdated=[],this.resultsOnUpdated=[]}set contest(t){this._contest=t,this.contestOnUpdated.forEach(e=>e(t))}get contest(){return this._contest}set results(t){this._results=t,this.resultsOnUpdated.forEach(e=>e(t))}get results(){return this._results}isStandingsPage(){return/standings([^/]*)?$/.test(document.location.href)}afterAppend(){const t=()=>!!document.getElementById("standings-tbody");if(!this.isStandingsPage()||t())return void this.initialize();const e=document.getElementById("vue-standings").getElementsByClassName("loading-show")[0];new MutationObserver(()=>{t()&&this.initialize()}).observe(e,{attributes:!0})}initialize(){var t;return __awaiter(this,void 0,void 0,function*(){const e=new Date(2016,6,16,21),n=["predictor-input-rank","predictor-input-perf","predictor-input-rate","predictor-current","predictor-reload"],s=this.isStandingsPage(),i=yield getContestInformationAsync(contestScreenName),r=new PerfAndRateChangeAppender;this.resultsOnUpdated.push(t=>{r.results=t}),this.contestOnUpdated.push(t=>{r.isRated=t.IsRated});const a=new AllRowUpdater;a.rowModifier=r;const o=null===(t=document.getElementById("standings-tbody"))||void 0===t?void 0:t.parentElement;let d=new PredictorModel({rankValue:0,perfValue:0,rateValue:0,enabled:!1,history:this.historyData});const l=(t,e)=>__awaiter(this,void 0,void 0,function*(){if(this.contest=new Contest(contestScreenName,i,e,t),d.contest=this.contest,this.contest.standings.Fixed&&this.contest.IsRated){const t=yield getResultsDataAsync(contestScreenName);t.sort((t,e)=>t.Place!==e.Place?t.Place-e.Place:e.OldRating-t.OldRating);const e=Array.from(this.contest.standings.StandingsData);i.isHeuristic&&e.filter(t=>0!==t.TotalResult.Count),e.sort((t,e)=>0===t.TotalResult.Count&&0===e.TotalResult.Count?0:0===t.TotalResult.Count?1:0===e.TotalResult.Count?-1:t.Rank!==e.Rank?t.Rank-e.Rank:e.OldRating!==t.OldRating?e.OldRating-t.OldRating:t.UserIsDeleted?-1:e.UserIsDeleted?1:0);let n=this.contest.perfLimit,s=0;this.results=new FixedResults(e.map((e,r)=>{let a=t[r-s];return a&&e.OldRating===a.OldRating||(s++,a=null),new Result(!!a&&a.IsRated,!i.isHeuristic||0!==e.TotalResult.Count,e.UserScreenName,e.Rank,-1,e.OldRating,a?a.NewRating:0,0,a&&a.IsRated?n=a.Performance:n,a?a.InnerPerformance:0)}))}else this.results=new OnDemandResults(this.contest,this.contest.templateResults)});if(!u().verdict)return d.updateInformation(u().message),void p();try{let t,e;try{e=yield getStandingsDataAsync(contestScreenName)}catch(t){throw new Error("Standings读取失败。")}try{t=yield getAPerfsDataAsync(contestScreenName)}catch(t){throw new Error("APerf获取失败。")}if(yield l(t,e),d.setEnable(!0),d.updateInformation(`最后更新时间: ${(new Date).toTimeString().split(" ")[0]}`),s){new MutationObserver(()=>{a.update(o)}).observe(o.tBodies[0],{childList:!0});const t=document.getElementById("refresh");t&&new MutationObserver(t=>{t[0].target.classList.contains("disabled")&&(()=>__awaiter(this,void 0,void 0,function*(){yield c(),p()}))()}).observe(t,{attributes:!0,attributeFilter:["class"]})}}catch(t){d.updateInformation(t.message),d.setEnable(!1)}p();{const t=document.getElementById("predictor-reload");t.addEventListener("click",()=>{(()=>__awaiter(this,void 0,void 0,function*(){d.updateInformation(""),t.disabled=!0,p(),yield c(),t.disabled=!1,p()}))()}),document.getElementById("predictor-current").addEventListener("click",()=>{const t=this.contest.templateResults[userScreenName];t&&((d=new CalcFromRankModel(d)).updateData(t.RatedRank,d.perfValue,d.rateValue),p())}),document.getElementById("predictor-input-rank").addEventListener("keyup",()=>{const t=document.getElementById("predictor-input-rank").value,e=parseInt(t);isFinite(e)&&((d=new CalcFromRankModel(d)).updateData(e,0,0),p())}),document.getElementById("predictor-input-perf").addEventListener("keyup",()=>{const t=document.getElementById("predictor-input-perf").value,e=parseInt(t);isFinite(e)&&((d=new CalcFromPerfModel(d)).updateData(0,e,0),p())}),document.getElementById("predictor-input-rate").addEventListener("keyup",()=>{const t=document.getElementById("predictor-input-rate").value,e=parseInt(t);isFinite(e)&&((d=new CalcFromRateModel(d)).updateData(0,0,e),p())})}function c(){return __awaiter(this,void 0,void 0,function*(){try{const t=u();if(!t.verdict)return d.updateInformation(t.message),void d.setEnable(!1);const e=yield getStandingsDataAsync(contestScreenName),n=yield getAPerfsDataAsync(contestScreenName);yield l(n,e),d.updateInformation(`最后更新时间: ${(new Date).toTimeString().split(" ")[0]}`),d.setEnable(!0)}catch(t){d.updateInformation(t.message),d.setEnable(!1)}})}function u(){return new Date<startTime?{verdict:!1,message:"比赛暂未开始"}:startTime<e?{verdict:!1,message:"这场比赛是在使用现行 Rating 制度之前举行的，无法准确计算 Rating 数据。"}:i.RatedRange[0]>i.RatedRange[1]?{verdict:!1,message:"This contest is unrated."}:{verdict:!0,message:""}}function p(){const t=isFinite(d.rankValue)?roundValue(d.rankValue,2).toString():"",e=isFinite(d.perfValue)?roundValue(d.perfValue,2).toString():"",i=isFinite(d.rateValue)?roundValue(d.rateValue,2).toString():"";document.getElementById("predictor-input-rank").value=t,document.getElementById("predictor-input-perf").value=e,document.getElementById("predictor-input-rate").value=i,document.getElementById("predictor-alert").innerHTML=`<h5 class='sidemenu-txt'>${d.information}</h5>`,d.enabled,n.forEach(t=>{document.getElementById(t).disabled=!1}),s&&u().verdict&&a.update(o)}})}afterOpen(){return __awaiter(this,void 0,void 0,function*(){getPerformanceHistories(yield getHistoryDataAsync(userScreenName)).forEach(t=>this.historyData.push(t))})}}const predictor=new PredictorElement;var dom$1='<div id="estimator-alert"></div>\n<div class="row">\n\t<div class="input-group">\n\t\t<span class="input-group-addon" id="estimator-input-desc"></span>\n\t\t<input type="number" class="form-control" id="estimator-input">\n\t</div>\n</div>\n<div class="row">\n\t<div class="input-group">\n\t\t<span class="input-group-addon" id="estimator-res-desc"></span>\n\t\t<input class="form-control" id="estimator-res" disabled="disabled">\n\t\t<span class="input-group-btn">\n\t\t\t<button class="btn btn-default" id="estimator-toggle">交换</button>\n\t\t</span>\n\t</div>\n</div>\n<div class="row" style="margin: 10px 0px;">\n\t<a class="btn btn-default col-xs-offset-8 col-xs-4" rel="nofollow" onclick="window.open(encodeURI(decodeURI(this.href)),\'twwindow\',\'width=550, height=450, personalbar=0, toolbar=0, scrollbars=1\'); return false;" id="estimator-tweet">Tweet</a>\n</div>';class EstimatorModel{constructor(t,e){this.inputDesc="",this.resultDesc="",this.perfHistory=e,this.updateInput(t)}updateInput(t){this.inputValue=t,this.resultValue=this.calcResult(t)}toggle(){return null}calcResult(t){return t}}class CalcRatingModel extends EstimatorModel{constructor(t,e){super(t,e),this.inputDesc="Performance",this.resultDesc="预计 Rating"}toggle(){return new CalcPerfModel(this.resultValue,this.perfHistory)}calcResult(t){return positivizeRating(calcRatingFromHistory(this.perfHistory.concat([t])))}}class CalcPerfModel extends EstimatorModel{constructor(t,e){super(t,e),this.inputDesc="目标 Rating",this.resultDesc="所需 Performance"}toggle(){return new CalcRatingModel(this.resultValue,this.perfHistory)}calcResult(t){return calcRequiredPerformance(unpositivizeRating(t),this.perfHistory)}}function GetEmbedTweetLink(t,e){return`https://twitter.com/share?text=${encodeURI(t)}&url=${encodeURI(e)}`}function getLS(t){const e=localStorage.getItem(t);return e?JSON.parse(e):e}function setLS(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(t){console.log(t)}}const models=[CalcPerfModel,CalcRatingModel];function GetModelFromStateCode(t,e,n){let s=models.find(e=>e.name===t);return s||(s=CalcPerfModel),new s(e,n)}class EstimatorElement extends SideMenuElement{constructor(){super(...arguments),this.id="estimator",this.title="Estimator",this.document=dom$1,this.match=/atcoder.jp/}afterAppend(){}afterOpen(){return __awaiter(this,void 0,void 0,function*(){const t=document.getElementById("estimator-input"),e=document.getElementById("estimator-res");let n=GetModelFromStateCode(getLS("sidemenu_estimator_state"),getLS("sidemenu_estimator_value"),getPerformanceHistories(yield getHistoryDataAsync(userScreenName)));function s(){setLS("sidemenu_estimator_value",n.inputValue),setLS("sidemenu_estimator_state",n.constructor.name)}function i(){const s=roundValue(n.inputValue,2),i=roundValue(n.resultValue,2);document.getElementById("estimator-input-desc").innerText=n.inputDesc,document.getElementById("estimator-res-desc").innerText=n.resultDesc,t.value=String(s),e.value=String(i);const r=`AtCoderのハンドルネーム: ${userScreenName}\n${n.inputDesc}: ${s}\n${n.resultDesc}: ${i}\n`;document.getElementById("estimator-tweet").href=GetEmbedTweetLink(r,"https://greasyfork.org/ja/scripts/369954-ac-predictor")}i(),document.getElementById("estimator-toggle").addEventListener("click",()=>{n=n.toggle(),s(),i()}),t.addEventListener("keyup",()=>{!function(){const e=t.valueAsNumber;if(!isFinite(e))return;n.updateInput(e)}(),s(),i()})})}}const estimator=new EstimatorElement;var sidemenuHtml='<style>\n    #menu-wrap {\n        display: block;\n        position: fixed;\n        top: 0;\n        z-index: 20;\n        width: 400px;\n        right: -350px;\n        transition: all 150ms 0ms ease;\n        margin-top: 50px;\n    }\n\n    #sidemenu {\n        background: #000;\n        opacity: 0.85;\n    }\n    #sidemenu-key {\n        border-radius: 5px 0px 0px 5px;\n        background: #000;\n        opacity: 0.85;\n        color: #FFF;\n        padding: 30px 0;\n        cursor: pointer;\n        margin-top: 100px;\n        text-align: center;\n    }\n\n    #sidemenu {\n        display: inline-block;\n        width: 350px;\n        float: right;\n    }\n\n    #sidemenu-key {\n        display: inline-block;\n        width: 50px;\n        float: right;\n    }\n\n    .sidemenu-active {\n        transform: translateX(-350px);\n    }\n\n    .sidemenu-txt {\n        color: #DDD;\n    }\n\n    .menu-wrapper {\n        border-bottom: 1px solid #FFF;\n    }\n\n    .menu-header {\n        margin: 10px 20px 10px 20px;\n        user-select: none;\n    }\n\n    .menu-box {\n        overflow: hidden;\n        transition: all 300ms 0s ease;\n    }\n    .menu-box-collapse {\n        height: 0px !important;\n    }\n    .menu-box-collapse .menu-content {\n        transform: translateY(-100%);\n    }\n    .menu-content {\n        padding: 10px 20px 10px 20px;\n        transition: all 300ms 0s ease;\n    }\n    .cnvtb-fixed {\n        z-index: 19;\n    }\n</style>\n<div id="menu-wrap">\n    <div id="sidemenu" class="container"></div>\n    <div id="sidemenu-key" class="glyphicon glyphicon-menu-left"></div>\n</div>';class SideMenu{constructor(){this.pendingElements=[],this.Generate()}Generate(){document.getElementById("main-div").insertAdjacentHTML("afterbegin",sidemenuHtml),n();const t=document.getElementById("sidemenu-key"),e=document.getElementById("menu-wrap");function n(){document.getElementById("sidemenu").style.height=`${window.innerHeight}px`}t.addEventListener("click",()=>{this.pendingElements.forEach(t=>{t.afterOpen()}),this.pendingElements.length=0,t.classList.toggle("glyphicon-menu-left"),t.classList.toggle("glyphicon-menu-right"),e.classList.toggle("sidemenu-active")}),window.addEventListener("onresize",n),document.getElementById("sidemenu").addEventListener("click",t=>{const e=t.target;if(!e.closest(".menu-header"))return;e.closest(".menu-wrapper").querySelector(".menu-box").classList.toggle("menu-box-collapse");const n=e.querySelector(".glyphicon");n.classList.toggle("glyphicon-menu-down"),n.classList.toggle("glyphicon-menu-up")})}addElement(t){if(!t.shouldDisplayed(document.location.href))return;const e=document.getElementById("sidemenu");e.insertAdjacentHTML("afterbegin",t.GetHTML());const n=e.querySelector(".menu-content");n.parentElement.style.height=`${n.offsetHeight}px`,t.afterAppend(),this.pendingElements.push(t)}}const sidemenu=new SideMenu,elements=[predictor,estimator];for(let t=elements.length-1;t>=0;t--)sidemenu.addElement(elements[t]);